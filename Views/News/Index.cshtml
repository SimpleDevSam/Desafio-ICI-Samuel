@model Desafio_ICI_Samuel.Features.News.ListNews.ListNewsVm

<h1>Notícias</h1>

@if (TempData["msg"] is string ok)
{
    <div class="alert alert-success" role="alert">@ok</div>
}
@if (TempData["err"] is string err)
{
    <div class="alert alert-danger" role="alert">@err</div>
}

<div class="mb-3">
    <button type="button" class="btn btn-primary" id="btnCreateNews">Criar Notícia</button>
</div>

<div class="table-responsive">
    <table class="table table-sm align-middle">
        <thead>
            <tr>
                <th style="width:90px">ID</th>
                <th>Título</th>
                <th>Tags</th>
                <th>Autor</th>
                <th style="width:90px">Texto</th>
                <th class="text-nowrap"  style="width:260px">Ações</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var r in Model.Rows)
            {
                <tr id="row-@r.Id">
                    <td>@r.Id</td>
                    <td>@r.Title</td>
                    <td>@string.Join(", ", r.TagsName)</td>
                    <td>@r.UserName</td>
                    <td style="overflow-y: scroll; overflow-x: hidden; max-height: 100px; white-space: normal; word-break: break-word;"><div style="min-width:700px; max-height:200px">@r.Text</div></td>
                    <td>
                        <button type="button" class="btn btn-sm btn-outline-info me-1" data-view-news="@r.Id" >Ver</button>
                        <button type="button" class="btn btn-sm btn-outline-primary me-1" data-edit-news="@r.Id">Editar</button>
                        <form asp-action="Delete" asp-route-id="@r.Id" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-sm btn-outline-danger">Excluir</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div id="newsFormHost" class="mt-3"></div>

@{
    var current = Model.Page;
    var totalPages = Model.TotalPages;
    var total = Model.Total;

    int window = 5;
    int start = Math.Max(1, current - window);
    int end = Math.Min(totalPages, current + window);

    string PageUrl(int p) => Url.Action("Index", "News", new { page = p })!;
}

@if (total > 0 && totalPages > 1)
{
    <div class="d-flex justify-content-between align-items-center mt-2">
        <small class="text-muted">Page @current of @totalPages — @total total</small>

        <nav aria-label="News pagination">
            <ul class="pagination mb-0">
                @if (current <= 1)
                {
                    <li class="page-item disabled"><span class="page-link">Anterior</span></li>
                }
                else
                {
                    <li class="page-item"><a class="page-link" href="@PageUrl(current - 1)">Próximo</a></li>
                }

                @if (start > 1)
                {
                    <li class="page-item"><a class="page-link" href="@PageUrl(1)">1</a></li>
                    @if (start > 2)
                    {
                        <li class="page-item disabled"><span class="page-link">…</span></li>
                    }
                }

                @for (var p = start; p <= end; p++)
                {
                    if (p == current)
                    {
                        <li class="page-item active"><span class="page-link">@p</span></li>
                    }
                    else
                    {
                        <li class="page-item"><a class="page-link" href="@PageUrl(p)">@p</a></li>
                    }
                }

                @if (end < totalPages)
                {
                    if (end < totalPages - 1)
                    {
                        <li class="page-item disabled"><span class="page-link">…</span></li>
                    }
                    <li class="page-item"><a class="page-link" href="@PageUrl(totalPages)">@totalPages</a></li>
                }

                @if (current >= totalPages)
                {
                    <li class="page-item disabled"><span class="page-link">Next</span></li>
                }
                else
                {
                    <li class="page-item"><a class="page-link" href="@PageUrl(current + 1)">Próximo</a></li>
                }
            </ul>
        </nav>
    </div>
}

@section Scripts {
    <script src="~/features/news/index.js" asp-append-version="true"></script>
}
