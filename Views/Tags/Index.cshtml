@model Desafio_ICI_Samuel.Features.Tags.List.ListTagsVm

<h1>Tags</h1>

@if (TempData["msg"] is string ok)
{
    <div class="alert alert-success">@ok</div>
}
@if (TempData["err"] is string err)
{
    <div class="alert alert-danger">@err</div>
}

<form id="__af" method="post">@Html.AntiForgeryToken()</form>

<a asp-action="Create" class="btn btn-primary">Criar Tag</a>

<table class="table table-sm">
    <thead>
        <tr>
            <th style="width:100px">ID</th>
            <th>Nome</th>
            <th style="width:260px">Ações</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var r in Model.Rows)
        {
            <tr id="row-@r.Id">
                <td>@r.Id</td>
                <td>@r.Nome</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@r.Id" class="btn btn-sm btn-outline-primary me-1">Edição</a>
                    <a asp-action="Get" asp-route-id="@r.Id" class="btn btn-sm btn-outline-secondary me-1">Ver</a>
                    <form asp-action="Delete" asp-route-id="@r.Id" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-sm btn-outline-danger">Excluir</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

@{
    var search = Context.Request.Query["search"].ToString();
    var current = Model.Page;
    var totalPages = Model.TotalPages;
    var total = Model.Total;

    int window = 5;
    int start = Math.Max(1, current - window);
    int end = Math.Min(totalPages, current + window);

    string PageUrl(int p) => Url.Action(
        action: "Index",
        controller: "Tags",
        values: new { page = p, search = string.IsNullOrWhiteSpace(search) ? null : search }
    )!;
}

@if (total > 0 && totalPages > 1)
{
    <div class="d-flex justify-content-between align-items-center mt-2">
        <small class="text-muted">
            Page @current of @totalPages — @total total
        </small>

        <nav aria-label="Tags pagination">
            <ul class="pagination mb-0">

                @if (current <= 1)
                {
                    <li class="page-item disabled"><span class="page-link">Anterior</span></li>
                }
                else
                {
                    <li class="page-item"><a class="page-link" href="@PageUrl(current - 1)">Anterior</a></li>
                }

                @if (start > 1)
                {
                    <li class="page-item"><a class="page-link" href="@PageUrl(1)">1</a></li>
                    @if (start > 2)
                    {
                        <li class="page-item disabled"><span class="page-link">…</span></li>
                    }
                }

                @for (var p = start; p <= end; p++)
                {
                    if (p == current)
                    {
                        <li class="page-item active"><span class="page-link">@p</span></li>
                    }
                    else
                    {
                        <li class="page-item"><a class="page-link" href="@PageUrl(p)">@p</a></li>
                    }
                }

                @if (end < totalPages)
                {
                    if (end < totalPages - 1)
                    {
                        <li class="page-item disabled"><span class="page-link">…</span></li>
                    }
                    <li class="page-item"><a class="page-link" href="@PageUrl(totalPages)">@totalPages</a></li>
                }

                @if (current >= totalPages)
                {
                    <li class="page-item disabled"><span class="page-link">Próximo</span></li>
                }
                else
                {
                    <li class="page-item"><a class="page-link" href="@PageUrl(current + 1)">Próximo</a></li>
                }

            </ul>
        </nav>
    </div>
}

@section Scripts {
    <script src="~/features/tags/index.js" asp-append-version="true"></script>
}
